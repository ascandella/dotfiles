#
# Helper functions
#
_command_exists() {
  command -v "${1}" >/dev/null
}

# Alias $1 to $2 if $2 is a thing
_aliasto () {
  if [ $# -ne 2 ] ; then
    echo "Usage: $0 <from> <to>"
    return
  fi

  if _command_exists "${1}" ; then
    # shellcheck disable=SC2139
    alias "${2}"="${1}"
  fi
}

#
# Aliases
#

alias ll='ls -l'
alias ltr='ls -ltr'
alias rm > /dev/null && unalias rm
alias t='tmux -u'

alias grep='grep --color=auto'

alias rg="rg --hidden --glob '!.git'"
if _command_exists delta ; then
  # https://dandavison.github.io/delta/grep.html
  ag() {
    if [ -n "$1" ]; then
      local args=""
      if [[ -n "$2" && -z "$3" ]]; then
        args="-C $2"
      fi
      # https://github.com/dandavison/delta/issues/1588#issuecomment-e898999756
      rg --json "$1" ${=args} | delta --tabs=1
    else
      rg
    fi
  }
else
  _aliasto rg ag
fi

# Use Neovim nightly if installed
if [ -x "$HOME/src/neovim/nvim.appimage" ] ; then
  unalias vim 2&> /dev/null
  alias vim="$HOME/src/neovim/nvim.appimage"
  alias nvim="$HOME/src/neovim/nvim.appimage"
  export EDITOR="$HOME/src/neovim/nvim.appimage"
fi

#
# Git aliases
#

if _command_exists git ; then
  alias git='nocorrect git'
fi

alias g='nocorrect git'
alias gp='git add -p'
alias gr='git rebase'
alias gco='git checkout'
alias gcp='git cherry-pick'
alias gca='git commit --amend'
alias gcaf='git commit --amend --no-verify'
alias gcn='git commit --amend --no-verify --no-edit'
alias gst='git status -sb'

# Elixir aliases
alias mts='mix test --stale'
alias mtf='mix test --failed'

#
# Global aliases
#
alias -g G=' | grep '

if _command_exists bat ; then
  alias cat='bat'
elif _command_exists ccat ; then
  alias cat='ccat --bg=dark'
fi

if _command_exists viddy ; then
  alias watch='viddy'
fi

if _command_exists kubectl ; then
  alias k='kubectl'
  alias krp='kubectl get pods --field-selector=status.phase=Running'
  alias kc='kubectl config use-context'

  ks () {
    kubectl get secret -n "$1" "$2" -o=go-template="{{index .data \"$3\"}}" | base64 -d
  }
fi

_aliasto vim vi
_aliasto nvim vim

# shellcheck disable=SC2139
alias updatedotfiles="FORCE_DOTFILES_UPDATE=1 source ${DOTFILES}/shell/autoupdate"

alias dockeruntagged='docker images | grep "<none>" | awk "{print \$3}"'

unset -f _aliasto
# vi: ft=zsh
